<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!-- Bootstrap CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
        <!-- Local CSS -->
        <title>ManChEWS</title>
    </head>

    <body>
        <div class="px-4 py-lg-5 my-lg-5 my-3 text-center">
            <div class="col-lg-6 mx-auto">
                <div class="sticky-top bg-white">
                    <h1 class="display-5 fw-bold">ManChEWS</h1>
                    <div class="alert alert-success" role="alert" id="score-alert">
                        Score: 0
                    </div>
                </div>
                <p class="lead mb-4">The Manchester Children's Early Warning System (ManChEWS) assesses six
                    physiological observations to create a trigger score, classified as Green, Amber or Red.</p>
                <div class="row align-items-center">
                    <div class="col">
                        <label for="rangeHeartRate" class="form-label" id="labelHeartRate">Heart Rate</label>
                        <input type="range" class="form-range " min="0" max="230" value="130" id="rangeHeartRate"
                            oninput="changeLabel(this.value, label_hr)">
                    </div>
                    <div class="col">
                        <h3 id="hr">130</h3>
                    </div>
                </div>
                <div class="row align-items-center">
                    <div class="col">
                        <label for="rangeRespiratoryRate" class="form-label" id="labelRespiratoryRate">Respiratory
                            Rate</label>
                        <input type="range" class="form-range " min="0" max="60" value="30" id="rangeRespiratoryRate"
                            oninput="changeLabel(this.value, label_rr)">
                    </div>
                    <div class="col">
                        <h3 id="rr">30</h3>
                    </div>
                </div>
                <div class="row align-items-center">
                    <div class="col">
                        <label for="rangeBloodPressure" class="form-label" id="labelBloodPressure">Systolic Blood
                            Pressure</label>
                        <input type="range" class="form-range " min="0" max="200" value="80" id="rangeBloodPressure"
                            oninput="changeLabel(this.value, label_bp)">
                    </div>
                    <div class="col">
                        <h3 id="bp">80</h3>
                    </div>
                </div>
                <h4 class="text-start pt-3">AVPU</h4>
                <div class="row align-items-center">
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check " name="avpu" id="avpu1" autocomplete="off" value="1"
                            checked>
                        <label class="btn btn-outline-primary" for="avpu1">Alert</label>
                        <input type="radio" class="btn-check " name="avpu" id="avpu2" autocomplete="off" value="2">
                        <label class="btn btn-outline-primary" for="avpu2">Voice / Pain</label>
                        <input type="radio" class="btn-check " name="avpu" id="avpu3" autocomplete="off" value="3">
                        <label class="btn btn-outline-primary" for="avpu3">Unresponsive</label>
                    </div>
                </div>
                <h4 class="text-start pt-3">Capillary Refill</h4>
                <div class="row align-items-center">
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check " name="crt" id="crt1" autocomplete="off" value="1"
                            checked>
                        <label class="btn btn-outline-primary" for="crt1">&lt; 2 seconds</label>
                        <input type="radio" class="btn-check " name="crt" id="crt2" autocomplete="off" value="2">
                        <label class="btn btn-outline-primary" for="crt2">2 - 4 seconds</label>
                        <input type="radio" class="btn-check " name="crt" id="crt3" autocomplete="off" value="3">
                        <label class="btn btn-outline-primary" for="crt3">&gt; 4 seconds</label>
                    </div>
                </div>
                <h4 class="text-start pt-3">Oxygen Saturation</h4>
                <div class="row align-items-center pb-3">
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check " name="sat" id="sat1" autocomplete="off" value="1"
                            checked>
                        <label class="btn btn-outline-primary" for="sat1">&gt; 95% in air</label>
                        <input type="radio" class="btn-check " name="sat" id="sat2" autocomplete="off" value="2">
                        <label class="btn btn-outline-primary" for="sat2">&lt; 95% in air</label>
                        <input type="radio" class="btn-check " name="sat" id="sat3" autocomplete="off" value="3">
                        <label class="btn btn-outline-primary" for="sat3">&lt; 95% in O2</label>
                    </div>
                </div>
                <hr class="m-4">
                <div class="row align-items-center pt-3">
                    <div class="btn-group" role="group">
                        <input type="radio" class="btn-check " name="age" id="age1" autocomplete="off" value="1">
                        <label class="btn btn-outline-primary" for="age1">&lt; 4 months</label>
                        <input type="radio" class="btn-check " name="age" id="age2" autocomplete="off" value="2"
                            checked>
                        <label class="btn btn-outline-primary" for="age2">4 months to 2 years</label>
                        <input type="radio" class="btn-check " name="age" id="age3" autocomplete="off" value="3">
                        <label class="btn btn-outline-primary" for="age3">2 to 5 years</label>
                        <input type="radio" class="btn-check " name="age" id="age4" autocomplete="off" value="4">
                        <label class="btn btn-outline-primary" for="age4">5 to 12 years</label>
                        <input type="radio" class="btn-check " name="age" id="age5" autocomplete="off" value="5">
                        <label class="btn btn-outline-primary" for="age5">&gt; 12 years</label>
                    </div>
                </div>
                <a tabindex="0" class="m-5" role="button" data-bs-toggle="popover" data-bs-trigger="focus"
                    data-bs-title="Dismissible popover"
                    data-bs-content="And here's some amazing content. It's very engaging. Right?">Dismissible
                    popover</a>
            </div>
        </div>
    </body>
    <!-- JavaScript -->
    <script>
        const hr = document.getElementById('rangeHeartRate');
        const rr = document.getElementById('rangeRespiratoryRate');
        const bp = document.getElementById('rangeBloodPressure');

        const label_hr = document.getElementById('hr');
        const label_rr = document.getElementById('rr');
        const label_bp = document.getElementById('bp');

        const overall_score = 0;

        const radios = document.querySelectorAll('.btn-check');
        const sliders = document.querySelectorAll('.form-range');

        const alert = document.getElementById('score-alert');

        function changeLabel(newVal, elem) {
            elem.innerHTML = newVal;
        }

        function convert_age(input) {
            const age_dict = { '1': 'infant', '2': 'toddler', '3': 'small_child', '4': 'child', '5': 'teen' };
            return age_dict[input]
        }

        function score_rr(age, rr) {
            const infant = [20, 29, 39, 54]
            const toddler = [15, 24, 34, 55]
            const small_child = [10, 19, 29, 45]
            const child = [10, 19, 29, 45]
            const teen = [10, 14, 24, 45]

            const age_dict = { 'infant': infant, 'toddler': toddler, 'small_child': small_child, 'child': child, 'teen': teen };

            const score = [4, 1, 0, 1, 4]
            const array = age_dict[age]
            for (var i = 0; i < array.length; i++) {
                if (array[i] > rr) {
                    return score[i]
                }
            }
            return score[score.length - 1]
        }

        function score_hr(age, hr) {
            const infant = [80, 109, 159, 190]
            const toddler = [80, 99, 149, 180]
            const small_child = [60, 79, 119, 150]
            const child = [60, 69, 119, 150]
            const teen = [55, 64, 99, 150]

            const age_dict = { 'infant': infant, 'toddler': toddler, 'small_child': small_child, 'child': child, 'teen': teen };

            const score = [4, 1, 0, 1, 4]
            const array = age_dict[age]
            for (var i = 0; i < array.length; i++) {
                if (array[i] > hr) {
                    return score[i]
                }
            }
            return score[score.length - 1]
        }

        function score_bp(age, bp) {
            const infant = [50, 59, 79, 100]
            const toddler = [60, 69, 89, 110]
            const small_child = [80, 89, 129, 150]
            const child = [80, 89, 129, 150]
            const teen = [80, 89, 129, 160]

            const age_dict = { 'infant': infant, 'toddler': toddler, 'small_child': small_child, 'child': child, 'teen': teen };

            const score = [4, 1, 0, 1, 4]
            const array = age_dict[age]
            for (var i = 0; i < array.length; i++) {
                if (array[i] > bp) {
                    return score[i]
                }
            }
            return score[score.length - 1]
        }

        function score_avpu(input) {
            const dict = { "1": 0, "2": 2, "3": 4 }
            return dict[input]
        }

        function score_cap(input) {
            const dict = { "1": 0, "2": 1, "3": 4 }
            return dict[input]
        }

        function score_o2(input) {
            const dict = { "1": 0, "2": 1, "3": 4 }
            return dict[input]
        }

        function total_score(age, hr, rr, bp, avpu, cap, o2) {
            const age_converted = convert_age(age)
            const score = score_hr(age_converted, hr) + score_rr(age_converted, rr) + score_bp(age_converted, bp) + score_avpu(avpu) + score_cap(cap) + score_o2(o2)
            return score
        }

        function apply_categories(total) {
            scoring = [2, 4]
            categories = ['alert alert-success', 'alert alert-warning', 'alert alert-danger']

            for (var i = 0; i < scoring.length; i++) {
                if (scoring[i] > total) {
                    return categories[i]
                }
            }
            return categories[categories.length - 1]
        }

        function collect_scores() {
            const hr_val = hr.value
            const rr_val = rr.value
            const bp_val = bp.value
            const avpu_val = document.querySelector('input[name="avpu"]:checked').value
            const cap_val = document.querySelector('input[name="crt"]:checked').value
            const o2_val = document.querySelector('input[name="sat"]:checked').value
            const age_val = document.querySelector('input[name="age"]:checked').value
            return total_score(age_val, hr_val, rr_val, bp_val, avpu_val, cap_val, o2_val)
        }

        radios.forEach(item => {
            item.addEventListener('click', e => {
                const score = collect_scores()
                alert.className = apply_categories(score)
                alert.innerText = 'Score: ' + score
            })
        })

        sliders.forEach(item => {
            item.addEventListener('input', e => {
                const score = collect_scores()
                alert.className = apply_categories(score)
                alert.innerText = 'Score: ' + score
            })
        })

    </script>

</html>
